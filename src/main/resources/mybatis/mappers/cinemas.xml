<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.moviefan.dao.CinemaDao">

	<!-- 전체 지역 정보 List<City> getAllCities(); -->
	<select id="getAllCities" parameterType="int" resultType="com.jhta.moviefan.vo.City">
		select
			city_no						as no,
			city_name					as name
		from
			city
	</select>
	
	<select id="getCityByNo" parameterType="int" resultType="com.jhta.moviefan.vo.City">
		select
			city_no						as no,
			city_name					as name
		from
			city
		where
			city_no = #{value}
	</select>
	
	<!-- 전체 영화관 정보 List<CinemaDto> getAllCinemas(); -->
	<select id="getAllCinemas" resultType="com.jhta.moviefan.dto.CinemaDto">
		select
			a.cinema_no 				as no,
			a.cinema_name 				as name,
			a.cinema_address 			as address,
			a.cinema_total_halls 		as totalHalls,
			b.city_name					as cityName,
			b.city_no					as cityNo
		from
			cinema a, city b
		where
			a.city_no = b.city_no
		order by
			a.cinema_no
	</select>
	
	<!-- 지역번호로 영화관 조회 List<CinemaNameDto> getCinemaNameByCityNo(); -->
	<select id="getCinemaListByCityNo" parameterType="int" resultType="com.jhta.moviefan.vo.Cinema">
 		select
 			cinema_no 					as no,
 			cinema_name 				as name
 		from
 			cinema 
 		where
 			city_no = #{value}
	</select>
	
	<!-- 영화관별 상영시간표 List<MovieTimeTableDto> getMovieTimeTableByCinemaNo(int cinemaNo); -->
	<select id="getMovieTimeTableByCinemaNo" parameterType="int" resultType="com.jhta.moviefan.dto.MovieTimeTableDto">
		select
		    a.city_no 											as cityNo,
		    a.city_name 										as cityName,
		    b.cinema_name 										as cinemaName,
		    d.show_no                                    		as showNo,
		    c.hall_name 										as hallName,
		    e.movie_title 										as title,
		    e.movie_runtime 									as runtime,
		     to_char(e.movie_open_date, 'YYYY-MM-DD') 			as openDate,
		    to_char(d.show_date, 'YYYY-MM-DD')	 				as showDate,
		    to_char(d.show_start_time, 'HH24:MI') 				as startTime,
		    to_char(d.show_end_time, 'HH24:MI')  				as endTime
		from
		    city a, cinema b, cinema_hall c, show d, movie e
		where
		    a.city_no = b.city_no
		and
		    b.cinema_no = c.cinema_no
		and
		    c.hall_no = d.hall_no
		and
		    d.movie_no = e.movie_no
		and
			b.cinema_no = #{value}
		order by
			c.hall_no asc
	</select>

	<select id="getMovieTimeTableByShowNo" parameterType="int" resultType="com.jhta.moviefan.dto.MovieTimeTableDto">
		select
		    a.city_no 											as cityNo,
		    a.city_name 										as cityName,
		    b.cinema_name 										as cinemaName,
		    d.show_no                                    		as showNo,
		    c.hall_name 										as hallName,
		    e.movie_title 										as title,
		    e.movie_runtime 									as runtime,
		    to_char(e.movie_open_date, 'YYYY-MM-DD') 			as openDate,
		    to_char(d.show_date, 'YYYY-MM-DD')	 				as showDate,
		    to_char(d.show_start_time, 'HH24:MI') 				as startTime,
		    to_char(d.show_end_time, 'HH24:MI')  				as endTime
		from
		    city a, cinema b, cinema_hall c, show d, movie e
		where
		    a.city_no = b.city_no
		and
		    b.cinema_no = c.cinema_no
		and
		    c.hall_no = d.hall_no
		and
		    d.movie_no = e.movie_no
		and
			d.show_no = #{value}
	</select>

</mapper>